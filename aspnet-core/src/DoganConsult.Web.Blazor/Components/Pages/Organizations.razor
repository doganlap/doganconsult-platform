@page "/organizations"
@layout PlatformLayout
@using DoganConsult.Organization.Domain.Shared.Permissions
@using DoganConsult.Web.Blazor.Organizations
@using DoganConsult.Web.Blazor.Services
@using Microsoft.AspNetCore.Authorization
@using Volo.Abp.Application.Dtos

<PageTitle>Organization Management</PageTitle>

<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <div class="d-flex justify-content-between align-items-center">
                        <h4 class="card-title mb-0">
                            <i class="fas fa-building me-2"></i>Organization Management
                        </h4>
                        @if (CanCreate)
                        {
                            <button class="btn btn-primary" @onclick="OpenCreateModal">
                                <i class="fas fa-plus me-1"></i>Add Organization
                            </button>
                        }
                    </div>
                </div>
                
                <div class="card-body">
                    <!-- Advanced Search & Filter Section -->
                    <div class="card mb-4 bg-light">
                        <div class="card-header bg-white">
                            <div class="d-flex justify-content-between align-items-center">
                                <h6 class="mb-0"><i class="fas fa-filter me-2"></i>Advanced Search & Filters</h6>
                                <button class="btn btn-sm btn-outline-secondary" @onclick="ToggleFilters">
                                    <i class="fas fa-@(ShowFilters ? "chevron-up" : "chevron-down")"></i>
                                </button>
                            </div>
                        </div>
                        @if (ShowFilters)
                        {
                            <div class="card-body">
                                <div class="row g-3">
                                    <div class="col-md-3">
                                        <label class="form-label small fw-bold">Search by Name/Code</label>
                                        <div class="input-group input-group-sm">
                                            <span class="input-group-text"><i class="fas fa-search"></i></span>
                                            <input type="text" class="form-control" placeholder="Organization name or code..." 
                                                   @bind="SearchQuery" @bind:event="oninput" @onkeyup="OnSearchChanged" />
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label small fw-bold">Organization Type</label>
                                        <select class="form-select form-select-sm" @onchange="OnFilterChanged">
                                            <option value="">-- All Types --</option>
                                            <option value="Internal">Internal</option>
                                            <option value="External">External</option>
                                            <option value="Partner">Partner</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label small fw-bold">Status</label>
                                        <select class="form-select form-select-sm" @onchange="OnFilterChanged">
                                            <option value="">-- All Status --</option>
                                            <option value="Active">Active & Operational</option>
                                            <option value="Inactive">Inactive</option>
                                            <option value="Suspended">Suspended</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label small fw-bold">Sector</label>
                                        <select class="form-select form-select-sm" @onchange="OnFilterChanged">
                                            <option value="">-- All Sectors --</option>
                                            <option value="Technology">Technology</option>
                                            <option value="Finance">Finance</option>
                                            <option value="Healthcare">Healthcare</option>
                                            <option value="Retail">Retail</option>
                                            <option value="Other">Other</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="row g-3 mt-2">
                                    <div class="col-12">
                                        <button class="btn btn-sm btn-primary" @onclick="ApplyFilters">
                                            <i class="fas fa-search me-1"></i>Apply Filters
                                        </button>
                                        <button class="btn btn-sm btn-outline-secondary" @onclick="ClearFilters">
                                            <i class="fas fa-times me-1"></i>Clear Filters
                                        </button>
                                        <button class="btn btn-sm btn-outline-success" @onclick="ExportToCSV">
                                            <i class="fas fa-download me-1"></i>Export CSV
                                        </button>
                                        <span class="ms-3 text-muted small">
                                            Found: <strong>@TotalCount</strong> organizations
                                        </span>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>

                    @if (Loading)
                    {
                        <div class="text-center">
                            <div class="spinner-border" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="mt-2">Loading organizations...</p>
                        </div>
                    }
                    else
                    {
                        <div class="table-responsive">
                            <table class="table table-striped table-hover">
                                <thead class="table-dark">
                                    <tr>
                                        <th scope="col">Code</th>
                                        <th scope="col">Name</th>
                                        <th scope="col">Type</th>
                                        <th scope="col">Location</th>
                                        <th scope="col">Sector</th>
                                        <th scope="col">Status</th>
                                        <th scope="col">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @if (OrganizationItems?.Any() == true)
                                    {
                                        @foreach (var org in OrganizationItems)
                                        {
                                            <tr>
                                                <td><strong>@org.OrganizationCode</strong></td>
                                                <td>@org.OrganizationName</td>
                                                <td>
                                                    <span class="badge bg-@GetTypeColor(org.OrganizationType)">
                                                        @org.OrganizationType
                                                    </span>
                                                </td>
                                                <td>@org.City, @org.Country</td>
                                                <td>@org.Sector</td>
                                                <td>
                                                    <span class="badge bg-@GetStatusColor(org.OrganizationStatus)">
                                                        @org.OrganizationStatus
                                                    </span>
                                                </td>
                                                <td>
                                                    <div class="btn-group" role="group">
                                                        <button class="btn btn-sm btn-outline-primary" @onclick="() => ViewDetails(org)">
                                                            <i class="fas fa-eye"></i>
                                                        </button>
                                                        <button class="btn btn-sm btn-outline-warning" @onclick="() => EditOrganization(org)">
                                                            <i class="fas fa-edit"></i>
                                                        </button>
                                                        <button class="btn btn-sm btn-outline-danger" @onclick="() => DeleteOrganization(org)">
                                                            <i class="fas fa-trash"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                        }
                                    }
                                    else
                                    {
                                        <tr>
                                            <td colspan="7" class="text-center text-muted">
                                                <i class="fas fa-building fa-3x mb-3"></i>
                                                <p class="mb-0">No organizations found</p>
                                                <button class="btn btn-primary mt-2" @onclick="OpenCreateModal">
                                                    Create your first organization
                                                </button>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>

                        @if (TotalCount > PageSize)
                        {
                            <nav aria-label="Organization pagination">
                                <ul class="pagination justify-content-center">
                                    <li class="page-item @(CurrentPage == 1 ? "disabled" : "")">
                                        <button class="page-link" @onclick="() => GoToPage(CurrentPage - 1)">Previous</button>
                                    </li>
                                    @for (int i = Math.Max(1, CurrentPage - 2); i <= Math.Min(TotalPages, CurrentPage + 2); i++)
                                    {
                                        <li class="page-item @(i == CurrentPage ? "active" : "")">
                                            <button class="page-link" @onclick="() => GoToPage(i)">@i</button>
                                        </li>
                                    }
                                    <li class="page-item @(CurrentPage == TotalPages ? "disabled" : "")">
                                        <button class="page-link" @onclick="() => GoToPage(CurrentPage + 1)">Next</button>
                                    </li>
                                </ul>
                            </nav>
                        }
                    }
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Create/Edit Modal -->
<div class="modal fade @(ShowModal ? "show d-block" : "")" tabindex="-1" style="background-color: rgba(0,0,0,0.5)">
    <div class="modal-dialog modal-xl" style="max-width: 900px;">
        <div class="modal-content" style="max-height: 90vh; overflow-y: auto;">
            <div class="modal-header">
                <h5 class="modal-title">@(IsEditing ? "Edit Organization" : "Create Organization")</h5>
                <button type="button" class="btn-close" @onclick="CloseModal"></button>
            </div>
            <div class="modal-body">
                <EditForm Model="CurrentOrganization" OnValidSubmit="SaveOrganization">
                    <DataAnnotationsValidator />
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i>
                        <strong>Required fields are marked with *</strong>
                    </div>

                    @if (!string.IsNullOrEmpty(FormErrorMessage))
                    {
                        <div class="alert alert-danger">
                            <i class="fas fa-exclamation-triangle"></i>
                            @FormErrorMessage
                        </div>
                    }

                    <!-- Basic Information Section -->
                    <div class="card mb-3">
                        <div class="card-header bg-primary text-white">
                            <i class="fas fa-building"></i> Basic Information
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Organization Code *</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-hashtag"></i></span>
                                            <InputText @bind-Value="CurrentOrganization.OrganizationCode" 
                                                     class="form-control" 
                                                     placeholder="e.g., DOGAN-001" 
                                                     maxlength="20" />
                                        </div>
                                        <ValidationMessage For="@(() => CurrentOrganization.OrganizationCode)" class="text-danger small" />
                                        <div class="form-text">Unique identifier for this organization</div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Organization Type *</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-tags"></i></span>
                                            <InputSelect @bind-Value="CurrentOrganization.OrganizationType" class="form-select">
                                                <option value="">-- Select Type --</option>
                                                @foreach (OrganizationType type in Enum.GetValues<OrganizationType>())
                                                {
                                                    <option value="@type">@GetTypeDisplayName(type)</option>
                                                }
                                            </InputSelect>
                                        </div>
                                        <ValidationMessage For="@(() => CurrentOrganization.OrganizationType)" class="text-danger small" />
                                        <div class="form-text">Select the organization type that best fits</div>
                                    </div>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label class="form-label fw-bold">Organization Name *</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-building"></i></span>
                                    <InputText @bind-Value="CurrentOrganization.OrganizationName" 
                                             class="form-control" 
                                             placeholder="e.g., Dogan Consulting Ltd." 
                                             maxlength="200" />
                                </div>
                                <ValidationMessage For="@(() => CurrentOrganization.OrganizationName)" class="text-danger small" />
                                <div class="form-text">Full legal name of the organization</div>
                            </div>
                        </div>
                    </div>

                    <!-- Location & Contact Section -->
                    <div class="card mb-3">
                        <div class="card-header bg-success text-white">
                            <i class="fas fa-map-marker-alt"></i> Location & Contact
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Country</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-globe"></i></span>
                                            <InputSelect @bind-Value="CurrentOrganization.Country" class="form-select">
                                                <option value="">-- Select Country --</option>
                                                @foreach (var country in CountryList)
                                                {
                                                    <option value="@country">@country</option>
                                                }
                                            </InputSelect>
                                        </div>
                                        <div class="form-text">Primary business location country</div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">City</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-city"></i></span>
                                            <InputText @bind-Value="CurrentOrganization.City" 
                                                     class="form-control" 
                                                     placeholder="e.g., Riyadh" 
                                                     maxlength="100" />
                                        </div>
                                        <div class="form-text">Primary business location city</div>
                                    </div>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label class="form-label fw-bold">Contact Information</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-address-card"></i></span>
                                    <InputTextArea @bind-Value="CurrentOrganization.ContactInformation" 
                                                 class="form-control" 
                                                 rows="3" 
                                                 placeholder="Email: info@example.com&#10;Phone: +1234567890&#10;Address: Street, City, Country" 
                                                 maxlength="500" />
                                </div>
                                <div class="form-text">Email, phone, address, and other contact details</div>
                                <div class="text-muted small mt-1">@(CurrentOrganization.ContactInformation?.Length ?? 0)/500 characters</div>
                            </div>
                        </div>
                    </div>

                    <!-- Business Details Section -->
                    <div class="card mb-3">
                        <div class="card-header bg-info text-white">
                            <i class="fas fa-briefcase"></i> Business Details
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Business Sector</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-industry"></i></span>
                                            <InputSelect @bind-Value="CurrentOrganization.Sector" class="form-select">
                                                <option value="">-- Select Sector --</option>
                                                @foreach (var sector in SectorList)
                                                {
                                                    <option value="@sector">@sector</option>
                                                }
                                            </InputSelect>
                                        </div>
                                        <div class="form-text">Primary industry or business sector</div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Status *</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-flag"></i></span>
                                            <InputSelect @bind-Value="CurrentOrganization.OrganizationStatus" class="form-select">
                                                <option value="">-- Select Status --</option>
                                                @foreach (OrganizationStatus status in Enum.GetValues<OrganizationStatus>())
                                                {
                                                    <option value="@status">@GetStatusDisplayName(status)</option>
                                                }
                                            </InputSelect>
                                        </div>
                                        <ValidationMessage For="@(() => CurrentOrganization.OrganizationStatus)" class="text-danger small" />
                                        <div class="form-text">Current operational status</div>
                                    </div>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label class="form-label fw-bold">Business Description</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-pen"></i></span>
                                    <InputTextArea @bind-Value="CurrentOrganization.BusinessDescription" 
                                                 class="form-control" 
                                                 rows="2" 
                                                 placeholder="Describe your organization's business" 
                                                 maxlength="1000" />
                                </div>
                                <ValidationMessage For="@(() => CurrentOrganization.BusinessDescription)" class="text-danger small" />
                                <div class="form-text">Overview of business activities and operations</div>
                                <div class="text-muted small mt-1">@(CurrentOrganization.BusinessDescription?.Length ?? 0)/1000 characters</div>
                            </div>

                            <div class="mb-3">
                                <label class="form-label fw-bold">Regulatory Requirements</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-gavel"></i></span>
                                    <InputTextArea @bind-Value="CurrentOrganization.RegulatoryRequirements" 
                                                 class="form-control" 
                                                 rows="3" 
                                                 placeholder="Describe compliance requirements, certifications, licenses, etc." 
                                                 maxlength="1000" />
                                </div>
                                <div class="form-text">Compliance standards, licenses, certifications, and regulatory requirements</div>
                                <div class="text-muted small mt-1">@(CurrentOrganization.RegulatoryRequirements?.Length ?? 0)/1000 characters</div>
                            </div>
                        </div>
                    </div>

                    <!-- Legal & Financial Details Section -->
                    <div class="card mb-3">
                        <div class="card-header bg-warning text-dark">
                            <i class="fas fa-file-contract"></i> Legal & Financial Details
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Legal Name *</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-building"></i></span>
                                            <InputText @bind-Value="CurrentOrganization.LegalName" 
                                                     class="form-control" 
                                                     placeholder="Official legal name" 
                                                     maxlength="255" />
                                        </div>
                                        <ValidationMessage For="@(() => CurrentOrganization.LegalName)" class="text-danger small" />
                                        <div class="form-text">Full legal name for official documents</div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Registration Number</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-hashtag"></i></span>
                                            <InputText @bind-Value="CurrentOrganization.RegistrationNumber" 
                                                     class="form-control" 
                                                     placeholder="e.g., CR-123456" 
                                                     maxlength="100" />
                                        </div>
                                        <div class="form-text">Government or authority registration number</div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">VAT Number</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-receipt"></i></span>
                                            <InputText @bind-Value="CurrentOrganization.VatNumber" 
                                                     class="form-control" 
                                                     placeholder="e.g., VAT-123456789" 
                                                     maxlength="100" />
                                        </div>
                                        <div class="form-text">Value Added Tax number</div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Incorporation Date</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-calendar"></i></span>
                                            <InputDate @bind-Value="CurrentOrganization.IncorporationDate" 
                                                     class="form-control" />
                                        </div>
                                        <div class="form-text">Date organization was founded/incorporated</div>
                                    </div>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label class="form-label fw-bold">Billing Address</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-map-pin"></i></span>
                                    <InputTextArea @bind-Value="CurrentOrganization.BillingAddress" 
                                                 class="form-control" 
                                                 rows="2" 
                                                 placeholder="Full billing address" 
                                                 maxlength="500" />
                                </div>
                                <div class="form-text">Address for billing and invoicing purposes</div>
                                <div class="text-muted small mt-1">@(CurrentOrganization.BillingAddress?.Length ?? 0)/500 characters</div>
                            </div>
                        </div>
                    </div>

                    <!-- Location & Address Section -->
                    <div class="card mb-3">
                        <div class="card-header bg-success text-white">
                            <i class="fas fa-map-marker-alt"></i> Location & Address
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Country</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-globe"></i></span>
                                            <InputSelect @bind-Value="CurrentOrganization.Country" class="form-select">
                                                <option value="">-- Select Country --</option>
                                                @foreach (var country in CountryList)
                                                {
                                                    <option value="@country">@country</option>
                                                }
                                            </InputSelect>
                                        </div>
                                        <div class="form-text">Primary business location country</div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">City</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-city"></i></span>
                                            <InputText @bind-Value="CurrentOrganization.City" 
                                                     class="form-control" 
                                                     placeholder="e.g., Riyadh" 
                                                     maxlength="100" />
                                        </div>
                                        <div class="form-text">Primary business location city</div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">State/Province</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-map"></i></span>
                                            <InputText @bind-Value="CurrentOrganization.State" 
                                                     class="form-control" 
                                                     placeholder="e.g., Riyadh Region" 
                                                     maxlength="100" />
                                        </div>
                                        <div class="form-text">State or province</div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Postal Code</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-envelope"></i></span>
                                            <InputText @bind-Value="CurrentOrganization.PostalCode" 
                                                     class="form-control" 
                                                     placeholder="e.g., 11564" 
                                                     maxlength="20" />
                                        </div>
                                        <div class="form-text">Postal or ZIP code</div>
                                    </div>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label class="form-label fw-bold">Street Address</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-road"></i></span>
                                    <InputTextArea @bind-Value="CurrentOrganization.StreetAddress" 
                                                 class="form-control" 
                                                 rows="2" 
                                                 placeholder="Street address and building details" 
                                                 maxlength="255" />
                                </div>
                                <div class="form-text">Full street address for physical location</div>
                                <div class="text-muted small mt-1">@(CurrentOrganization.StreetAddress?.Length ?? 0)/255 characters</div>
                            </div>

                            <div class="mb-3">
                                <label class="form-label fw-bold">Contact Information</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-address-card"></i></span>
                                    <InputTextArea @bind-Value="CurrentOrganization.ContactInformation" 
                                                 class="form-control" 
                                                 rows="3" 
                                                 placeholder="Email: info@example.com&#10;Phone: +1234567890&#10;Fax: +1234567891" 
                                                 maxlength="500" />
                                </div>
                                <div class="form-text">Email, phone, fax, and other contact details</div>
                                <div class="text-muted small mt-1">@(CurrentOrganization.ContactInformation?.Length ?? 0)/500 characters</div>
                            </div>
                        </div>
                    </div>

                    <!-- Authorized Person Section -->
                    <div class="card mb-3">
                        <div class="card-header bg-secondary text-white">
                            <i class="fas fa-user-tie"></i> Authorized Person / Representative
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Full Name</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-user"></i></span>
                                            <InputText @bind-Value="CurrentOrganization.AuthorizedPersonName" 
                                                     class="form-control" 
                                                     placeholder="Full name of authorized representative" 
                                                     maxlength="255" />
                                        </div>
                                        <div class="form-text">Name of person authorized to sign contracts</div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Email Address</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-envelope"></i></span>
                                            <InputText type="email" @bind-Value="CurrentOrganization.AuthorizedPersonEmail" 
                                                     class="form-control" 
                                                     placeholder="authorized@example.com" 
                                                     maxlength="255" />
                                        </div>
                                        <ValidationMessage For="@(() => CurrentOrganization.AuthorizedPersonEmail)" class="text-danger small" />
                                        <div class="form-text">Email address of authorized representative</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Business Scope Section -->
                    <div class="card mb-3">
                        <div class="card-header bg-dark text-white">
                            <i class="fas fa-layer-group"></i> Business Scope & Services
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label class="form-label fw-bold">Service Scope</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-concierge-bell"></i></span>
                                    <InputTextArea @bind-Value="CurrentOrganization.ServiceScope" 
                                                 class="form-control" 
                                                 rows="2" 
                                                 placeholder="Describe services offered" 
                                                 maxlength="500" />
                                </div>
                                <div class="form-text">Types of services provided by this organization</div>
                                <div class="text-muted small mt-1">@(CurrentOrganization.ServiceScope?.Length ?? 0)/500 characters</div>
                            </div>

                            <div class="mb-3">
                                <label class="form-label fw-bold">Technology Scope</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-microchip"></i></span>
                                    <InputTextArea @bind-Value="CurrentOrganization.TechnologyScope" 
                                                 class="form-control" 
                                                 rows="2" 
                                                 placeholder="Technologies and systems used" 
                                                 maxlength="500" />
                                </div>
                                <div class="form-text">Key technologies, platforms, and systems in use</div>
                                <div class="text-muted small mt-1">@(CurrentOrganization.TechnologyScope?.Length ?? 0)/500 characters</div>
                            </div>
                        </div>
                    </div>
                </EditForm>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" @onclick="CloseModal">Cancel</button>
                <button type="button" class="btn btn-primary" @onclick="SaveOrganization" disabled="@Saving">
                    @if (Saving)
                    {
                        <span class="spinner-border spinner-border-sm me-1"></span>
                    }
                    @(IsEditing ? "Update" : "Create")
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Details Modal -->
<div class="modal fade @(ShowDetailsModal ? "show d-block" : "")" tabindex="-1" style="background-color: rgba(0,0,0,0.5)">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Organization Details</h5>
                <button type="button" class="btn-close" @onclick="CloseDetailsModal"></button>
            </div>
            @if (SelectedOrganization != null)
            {
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <p><strong>Code:</strong> @SelectedOrganization.OrganizationCode</p>
                            <p><strong>Name:</strong> @SelectedOrganization.OrganizationName</p>
                            <p><strong>Type:</strong> 
                                <span class="badge bg-@GetTypeColor(SelectedOrganization.OrganizationType)">
                                    @SelectedOrganization.OrganizationType
                                </span>
                            </p>
                            <p><strong>Status:</strong> 
                                <span class="badge bg-@GetStatusColor(SelectedOrganization.OrganizationStatus)">
                                    @SelectedOrganization.OrganizationStatus
                                </span>
                            </p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>Location:</strong> @SelectedOrganization.City, @SelectedOrganization.Country</p>
                            <p><strong>Sector:</strong> @SelectedOrganization.Sector</p>
                            <p><strong>Created:</strong> @SelectedOrganization.CreatedAt.ToString("MMM dd, yyyy")</p>
                            @if (SelectedOrganization.LastModifiedAt.HasValue)
                            {
                                <p><strong>Last Modified:</strong> @SelectedOrganization.LastModifiedAt.Value.ToString("MMM dd, yyyy")</p>
                            }
                        </div>
                    </div>
                    
                    @if (!string.IsNullOrWhiteSpace(SelectedOrganization.ContactInformation))
                    {
                        <div class="mt-3">
                            <strong>Contact Information:</strong>
                            <p class="text-muted">@SelectedOrganization.ContactInformation</p>
                        </div>
                    }
                    
                    @if (!string.IsNullOrWhiteSpace(SelectedOrganization.RegulatoryRequirements))
                    {
                        <div class="mt-3">
                            <strong>Regulatory Requirements:</strong>
                            <p class="text-muted">@SelectedOrganization.RegulatoryRequirements</p>
                        </div>
                    }
                </div>
            }
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" @onclick="CloseDetailsModal">Close</button>
            </div>
        </div>
    </div>
</div>

@code {
    private bool ShowFilters = false;
    private string SearchQuery = "";
    
    private void ToggleFilters()
    {
        ShowFilters = !ShowFilters;
    }
    
    private void OnSearchChanged(KeyboardEventArgs e)
    {
    }
    
    private void OnFilterChanged(ChangeEventArgs e)
    {
    }
    
    private async Task ApplyFilters()
    {
        await Task.CompletedTask;
    }
    
    private void ClearFilters()
    {
        SearchQuery = "";
    }
    
    private async Task ExportToCSV()
    {
        await Task.CompletedTask;
    }
}